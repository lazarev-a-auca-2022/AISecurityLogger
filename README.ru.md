# AI Logger

## Уровни архитектуры

### 1. Уровень приема данных (Ingestion Layer)

Отвечает за сбор необработанных логов из различных источников и их надежную постановку в очередь для обработки.

-   **Компоненты:**
    -   **FluentD (или аналогичный масштабируемый сборщик логов):** Собирает логи из различных источников. Конфигурация будет уделять особое внимание надежной обработке ошибок и буферизации.
    -   **Kafka (или другая распределенная очередь сообщений):** Выступает в качестве высокопроизводительной, отказоустойчивой очереди сообщений для обработки различных объемов логов и предотвращения потери данных во время пиков обработки. Приоритет будет отдаваться масштабируемости и настройке.

### 2. Уровень обработки (Processing Layer)

Сосредоточен на преобразовании необработанных логов в структурированные данные и выполнении первоначального анализа.

-   **Компоненты:**
    -   **Модуль нормализации и структурирования логов:** Обрабатывает логи с уровня приема данных, нормализуя форматы и извлекая соответствующие метаданные. Этот модуль будет разработан с учетом масштабируемости.
    -   **Wazuh (или аналогичная платформа SIEM/анализа логов):** Выполняет анализ на основе правил, действует как система управления событиями безопасности и информацией, а также предоставляет возможности поиска. Интеграция с модулем нормализации обеспечит обработку структурированных данных.
    -   **Модуль AI-анализа (FastAPI с тонко настроенной NLP-моделью):** Получает структурированные логи или соответствующие извлеченные данные. Приложение FastAPI будет управлять пакетной обработкой для повышения эффективности. Ядром будет тонко настроенная NLP-модель, специально обученная на данных логов, связанных с безопасностью, для повышения точности и снижения ложных срабатываний/пропусков. Этот модуль будет разработан для горизонтального масштабирования.

### 3. Уровень обнаружения и корреляции (Detection & Correlation Layer)

Коррелирует результаты анализа на основе правил (Wazuh) и AI-анализа для выявления потенциальных угроз и генерации оповещений.

-   **Компоненты:**
    -   **Движок корреляции:** Этот компонент будет получать выходные данные из оповещений Wazuh и модуля AI-анализа. Он будет реализовывать сложные правила и логику корреляции для выявления сложных шаблонов атак.
    -   **Механизм разрешения конфликтов:** Критически важная часть движка корреляции, предназначенная для обработки потенциальных расхождений между результатами Wazuh и AI, приоритизируя оповещения на основе определенных уровней достоверности и правил.

### 4. Уровень хранения (Storage Layer)

Обеспечивает постоянное хранение и индексацию нормализованных, обработанных и проанализированных данных логов.

-   **Компоненты:**
    -   **MyScaleDB (или альтернатива, прошедшая бенчмаркинг, такая как ClickHouse/Elasticsearch):** Выбрана на основе бенчмаркинга производительности для эффективного хранения, индексации и запросов больших объемов временных рядов и структурированных данных. Для оптимальной производительности и масштабируемости будут реализованы стратегии шардирования и индексации.

### 5. Уровень отчетности и представления (Reporting & Presentation Layer)

Предоставляет интерфейсы для просмотра оповещений, генерации отчетов и доступа к проанализированным данным.

-   **Компоненты:**
    -   **Модуль отчетности (например, отчетность Wazuh или пользовательский):** Генерирует исчерпывающие отчеты на основе обнаруженных угроз и активности системы.
    -   **API и пользовательский интерфейс:** Предоставляет программный доступ к оповещениям и данным, а также пользовательский интерфейс для мониторинга и расследования.

### 6. Уровень оркестрации и управления (Orchestration & Management Layer)

Контролирует весь конвейер, управляя состоянием компонентов, масштабированием, конфигурацией и мониторингом.

-   **Компоненты:**
    -   **Платформа оркестрации (например, Kubernetes):** Управляет развертыванием, масштабированием и состоянием всех микросервисов и компонентов.
    -   **Система мониторинга и оповещения:** Обеспечивает видимость производительности конвейера, выявляет проблемы и генерирует оповещения об операционных проблемах.

## Конвейер данных (Data Pipelining)

Данные проходят через архитектуру по четкому конвейеру:

1.  Необработанные логи собираются FluentD и отправляются в Kafka.
2.  Уровень обработки потребляет сообщения из Kafka. Логи нормализуются и структурируются.
3.  Нормализованные логи передаются в Wazuh для анализа на основе правил, а также отправляются в модуль AI-анализа для анализа с использованием глубокого обучения.
4.  Выходные данные из Wazuh и модуля AI-анализа отправляются на уровень обнаружения и корреляции.
5.  Движок корреляции обрабатывает эти входные данные, применяет разрешение конфликтов и генерирует оповещения об обнаруженных угрозах.
6.  Нормализованные логи, результаты анализа и оповещения хранятся на уровне хранения.
7.  Уровень отчетности и представления получает доступ к данным с уровня хранения и уровня обнаружения и корреляции для предоставления отчетов и пользовательского интерфейса.
8.  Уровень оркестрации и управления контролирует все компоненты конвейера.

## Дорожная карта (Roadmap)

Дорожная карта разработки сосредоточена на построении многоуровневой архитектуры и решении ключевых областей для оптимизации:

1.  **Фаза 1: MVP основного конвейера:** Реализация базового потока данных через уровни приема, обработки (нормализация, первоначальная интеграция с Wazuh) и хранения.
2.  **Фаза 2: Интеграция AI:** Интеграция модуля AI-анализа с базовой NLP-моделью и его подключение к конвейеру.
3.  **Фаза 3: Обнаружение и корреляция:** Разработка движка корреляции и механизма разрешения конфликтов.
4.  **Фаза 4: Отчетность и пользовательский интерфейс:** Построение уровня отчетности и представления.
5.  **Фаза 5: Оптимизация и усиление:**
    -   Проведение комплексного стресс-тестирования и оптимизация компонентов для масштабируемости (FluentD, Kafka, FastAPI).
    -   Тонкая настройка или обучение NLP-модели на данных, специфичных для безопасности.
    -   Бенчмаркинг и окончательное определение решения для уровня хранения (MyScaleDB против альтернатив).
    -   Уточнение правил корреляции и логики разрешения конфликтов.
    -   Реализация надежной обработки ошибок и мониторинга.
6.  **Фаза 6: Расширенные функции:** Изучение альтернативных архитектурных шаблонов (например, ELT), интеграция внешних источников информации об угрозах и расширение возможностей AI.

## Решения (Solutions)

-   **Масштабируемость:** Использование распределенных систем, таких как Kafka, и проектирование компонентов для горизонтального масштабирования (FluentD, модуль AI, модуль нормализации) снижает узкие места при высокой нагрузке. Стресс-тестирование является ключевым пунктом дорожной карты.
-   **Точность модели AI:** Дорожная карта включает явные шаги по тонкой настройке или обучению NLP-модели на данных безопасности.
-   **Конфликты обнаружения угроз:** Специальный механизм разрешения конфликтов на уровне обнаружения и корреляции предназначен для управления разногласиями между результатами анализа на основе правил и AI.
-   **Производительность хранения:** Бенчмаркинг решений для хранения и реализация правильных стратегий индексации и шардирования обеспечивают эффективную обработку данных.
-   **Разнообразные форматы логов и граничные случаи:** Модуль нормализации и структурирования отвечает за обработку различных форматов, и комплексное тестирование включено в дорожную карту.
-   **Надежность AI:** Тонкая настройка и потенциальные будущие механизмы обратной связи направлены на повышение точности AI и снижение галлюцинаций.
-   **Ограничения API Wazuh:** Хотя Wazuh является компонентом, архитектура допускает альтернативные шаблоны доступа к данным, если ограничения API станут существенной проблемой.
-   **Оптимальные данные для AI:** Архитектура обеспечивает гибкость в предоставлении нормализованных или потенциально необработанных данных модулю AI, что может быть оптимизировано в процессе разработки.
-   **Чрезмерная зависимость от Wazuh:** Хотя Wazuh интегрирован, архитектура распределяет ключевые функции по уровням и включает отдельный путь AI-анализа, снижая зависимость от одной точки.
